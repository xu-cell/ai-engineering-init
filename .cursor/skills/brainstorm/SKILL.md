---
name: brainstorm
description: |
  当需要探索方案、头脑风暴、创意思维时自动使用此 Skill。

  触发场景：
  - 不知道怎么设计
  - 需要多种方案
  - 创意探索
  - 架构讨论
  - 功能规划
  - 业务扩展

  触发词：头脑风暴、方案、怎么设计、有什么办法、创意、讨论、探索、想法、建议、怎么做、如何实现、有哪些方式、能不能做、可以实现吗
---

# 头脑风暴框架

## 本项目技术约束（头脑风暴边界）

> **重要**：所有方案必须在以下技术栈约束内思考

### 后端技术边界（已集成）

| 层面 | 已集成技术 | 说明 |
|------|----------|------|
| **框架** | Spring Boot 3.5.9 | 核心框架 |
| **ORM** | MyBatis-Plus 3.5.16 | 数据持久层 |
| **缓存** | Redis + Redisson | 分布式缓存（Caffeine 本地缓存）|
| **消息** | Redis Streams | 轻量消息队列 |
| **定时** | SnailJob + @Scheduled | 分布式定时任务 |
| **认证** | Sa-Token 1.44.0 | 权限与认证 |
| **实时通信** | WebSocket + SSE | 实时推送（已集成） |
| **文件存储** | AWS S3 SDK | 对象存储（MinIO 兼容） |
| **数据加密** | AES/RSA | 字段级加密 |
| **短信** | SMS4j | 多平台短信 |
| **邮件** | Spring Mail | 邮件发送 |
| **第三方登录** | JustAuth | OAuth2（30+ 平台） |
| **Excel** | FastExcel | 导入导出 |

### 自行扩展的技术（框架未集成）

| 技术 | 使用场景 | 集成指南 |
|------|---------|---------|
| **RocketMQ** | 高吞吐消息队列、分布式事务 | 复杂业务场景自行引入 |
| **MQTT** | 物联网设备通信 | IoT 场景使用 mica-mqtt |
| **PostgreSQL/Oracle/SQL Server** | 多数据库支持 | SQL 脚本适配四个数据库版本 |
| **LangChain4j** | AI 大模型集成 | 需自行引入依赖 |
| **支付模块** | 微信/支付宝支付 | 需自行开发或引入第三方 |

### 可扩展的 Common 模块（24个）

```
核心: core, web, security, log, doc, bom
数据: mybatis, redis, json, encrypt, sensitive, oss, excel
认证: satoken, tenant, social
通信: mail, sms, websocket, sse
业务: job(SnailJob), idempotent, ratelimiter, translation
```

---

## 思维模式

### 发散思维 - 尽可能多的方案

1. **不评判**: 先不考虑可行性，尽可能多地列出想法
2. **联想**: 从一个想法延伸到相关想法
3. **模块复用**: 能否用现有 24 个 common 模块解决？
4. **跨界借鉴**: 其他系统怎么做的？
5. **反向思考**: 如果要让问题更糟，会怎么做？反过来就是解决方案

### 收敛思维 - 筛选最优方案

1. **复用优先**: 能否复用现有模块/代码？
2. **可行性**: 在现有技术栈内能否实现？
3. **多端一致**: 是否需要 PC 端和移动端同时支持？
4. **多租户兼容**: 是否支持多租户数据隔离？
5. **多数据库**: 是否需要兼容 MySQL/Oracle/PostgreSQL/SQL Server？
6. **成本**: 开发时间和复杂度如何？
7. **风险**: 有什么潜在问题？

---

## 本项目专属决策维度

### 必须考虑的 5 个维度

| 维度 | 问题 | 实现要点 |
|------|------|---------|
| **三层架构** | 如何分层设计？ | Controller → Service → Mapper（无 DAO 层，Service 直接调用 Mapper） |
| **模块划分** | 属于哪个模块？ | sys/demo/wf（标准）或 b/m/iot/crm（业务）|
| **多租户** | 数据需要租户隔离吗？ | Entity 继承 TenantEntity，自动 SQL 过滤 |
| **多端支持** | PC 端、移动端都需要吗？ | 同一套 API，按需扩展前端 |
| **多数据库** | 需要兼容多个数据库吗？ | SQL 脚本同步 4 个数据库文件 |

### 方案评估矩阵（本项目版）

```markdown
| 方案 | 复用度(25%) | 多端(20%) | 多租户(20%) | 多数据库(15%) | 开发量(20%) | 总分 |
|------|-------------|-----------|-------------|---------------|-------------|------|
| 方案A | 9 | 8 | 10 | 10 | 7 | 8.65 |
| 方案B | 6 | 10 | 10 | 8 | 8 | 8.30 |
| 方案C | 10 | 6 | 8 | 6 | 9 | 8.00 |

评分说明：1-10分，分数越高越好
- 复用度：能复用多少现有代码/模块
- 多端：PC端和移动端支持程度
- 多租户：租户隔离支持程度
- 多数据库：跨数据库兼容性
- 开发量：开发工作量（分数越高=工作量越少）
```

---

## 方案探索模板

### 1. 问题定义（本项目版）

```markdown
## 问题描述

### 基本信息
- **是什么**: [具体描述要实现的功能]
- **为什么重要**: [业务价值]
- **当前状态**: [现有系统如何处理/有无类似功能]
- **期望结果**: [希望达到的效果]

### 本项目约束
- **模块归属**: base / mall / crm / iot / 新模块
- **端支持**: PC端 / 移动端 / 两者都需要
- **租户**: 需要租户隔离 / 不需要（系统级）
- **数据库**: 只支持 MySQL / 需要多数据库兼容
```

### 2. 可复用资源盘点

```markdown
## 现有资源

### 可复用的 Common 模块
| 模块 | 是否可用 | 用途 |
|------|---------|------|
| ruoyi-common-redis | ✅ | 缓存、分布式锁 |
| ruoyi-common-websocket | ❓ | 实时推送 |
| ruoyi-common-encrypt | ❓ | 密钥加密存储 |
| ... | | |

### 可参考的现有功能
| 功能 | 位置 | 可复用部分 |
|------|------|-----------|
| 广告管理 | base/Ad | 完整 CRUD 模板 |
| 平台配置 | base/Platform | 配置管理模式 |
| 订阅消息 | api/app/Subscribe | 微信消息模板 |
| ... | | |

### 需要新开发的部分
- [ ] [需要开发的内容]
```

### 3. 方案列举

```markdown
## 可能方案

### 方案 A: 最大复用（推荐优先考虑）
- **描述**: 基于现有模块组合实现
- **复用**: [列出复用的模块/代码]
- **新开发**: [列出必须新写的部分]
- **优点**: 开发快、稳定性高
- **缺点**: [可能的限制]

### 方案 B: 适度扩展
- **描述**: 在现有基础上扩展新功能
- **复用**: [列出复用的模块/代码]
- **新开发**: [列出必须新写的部分]
- **优点**: 平衡复用与定制
- **缺点**: [可能的限制]

### 方案 C: 全新开发
- **描述**: 从零开始实现
- **复用**: 仅复用基础框架
- **新开发**: 全部业务逻辑
- **优点**: 完全定制、无历史包袱
- **缺点**: 开发量大、风险高
```

### 4. 推荐方案

```markdown
## 推荐方案

**推荐**: 方案 [X]

**理由**:
1. 复用了 [xxx] 模块，减少 [xx%] 开发量
2. 完全支持多租户/多端/多数据库
3. [其他理由]

**实施步骤**:
1. [ ] 数据库设计 → 使用 `/crud` 或 `database-ops` Skill
2. [ ] 后端开发 → 使用 `crud-development` Skill
3. [ ] PC 前端 → 使用 `ui-pc` Skill
4. [ ] 测试验证

**风险点**:
- [风险1] → 应对策略
- [风险2] → 应对策略
```

---

## 本项目典型业务场景

### 场景 1：新增业务管理模块

```
需求：新增"优惠券管理"功能

头脑风暴：
├── 模块归属
│   ├── mall（商城相关）✅ 推荐
│   ├── base（基础业务）
│   └── 新建 coupon 子模块
│
├── 功能拆解
│   ├── 优惠券模板管理（后台配置）
│   ├── 优惠券发放（手动/自动/领取）
│   ├── 优惠券使用（订单抵扣）
│   └── 优惠券统计（使用率/核销率）
│
├── 可复用
│   ├── Ad 模块 → 完整 CRUD 模板
│   ├── ruoyi-common-redis → 库存扣减分布式锁
│   ├── SnailJob → 过期自动作废任务
│   └── 字典管理 → 券类型/状态字典
│
└── 技术方案
    ├── 三层架构：Controller → Service → Mapper
    ├── 表设计：m_coupon_template, m_coupon_record
    ├── Service 层：buildQueryWrapper() 查询构建
    └── PC 端：管理员配置和审核页面
```

### 场景 2：接入第三方服务

```
需求：接入物流查询功能

头脑风暴：
├── 方案选择
│   ├── 方案 A：使用快递100 API
│   ├── 方案 B：使用快递鸟 API
│   └── 方案 C：自建物流爬虫（不推荐）
│
├── 可复用
│   ├── ruoyi-common-encrypt → 密钥加密存储
│   ├── ruoyi-common-redis → 结果缓存（5分钟）
│   ├── Spring RestTemplate → HTTP 客户端调用
│   └── Platform 模块 → 配置存储模式
│
├── 实现方式
│   ├── 新建 LogisticsService 接口
│   ├── 实现 Kuaidi100LogisticsImpl
│   ├── 支持后续扩展其他供应商（策略模式）
│   └── 配置项存入 sys_config 表或独立配置表
│
└── 注意事项
    ├── API 密钥加密存储（ruoyi-common-encrypt）
    ├── 调用频率限制（@RateLimiter 注解）
    ├── 查询结果缓存（Redis）
    └── 失败降级处理（重试 + 异常日志）
```

### 场景 3：实时通信需求

```
需求：实现消息实时推送

头脑风暴：
├── 技术选型
│   ├── WebSocket（ruoyi-common-websocket，已集成）✅ 首选
│   │   └── 适用：聊天、通知、状态同步、双向通信
│   ├── SSE（ruoyi-common-sse，已集成）
│   │   └── 适用：服务端单向推送、简单场景
│   └── 轮询（不推荐）
│       └── 原因：浪费资源、延迟高
│
├── 消息分类
│   ├── 系统通知 → 广播（发送所有连接）
│   ├── 个人消息 → 点对点（发送特定用户）
│   ├── 群组消息 → 组播（发送特定群组）
│   └── 订单状态 → 主题订阅（发布-订阅模式）
│
└── 可复用
    ├── ruoyi-common-websocket → 完整的 WebSocket 支持
    ├── ruoyi-common-redis → 在线状态/消息队列（多实例同步）
    └── 现有 WebSocket 示例代码 → 参考实现
```

### 场景 4：支付功能扩展

```
需求：增加支付方式

头脑风暴：
├── 支付模块现状（框架未内置，需自行开发）
│   ├── 方案 A：使用 IJPay（开源支付 SDK）自行集成
│   ├── 方案 B：使用 YunGouOS 等聚合支付平台
│   └── 方案 C：直接对接微信/支付宝官方 SDK
│
├── 需要自行开发的功能
│   ├── 支付配置管理（各租户独立密钥）
│   ├── 支付订单表设计（支付流水、对账）
│   ├── 回调通知处理（幂等 + 签名验证）
│   └── 退款与对账（定时任务自动对账）
│
├── 可复用的框架能力
│   ├── ruoyi-common-encrypt → API 密钥加密存储
│   ├── ruoyi-common-redis → 支付幂等（分布式锁）
│   ├── SnailJob → 定时对账任务
│   └── ruoyi-common-idempotent → 防重复支付
│
└── 注意事项
    ├── 多租户支付配置隔离（各租户独立密钥）
    ├── 支付安全（签名验证、HTTPS）
    ├── 回调可靠性（幂等 + 重试机制）
    └── 资金安全（事务一致性 + 对账）
```

### 场景 5：数据统计需求

```
需求：业务数据统计报表

头脑风暴：
├── 统计维度
│   ├── 时间维度：日/周/月/年/自定义范围
│   ├── 租户维度：单租户/全平台
│   ├── 业务维度：订单/用户/商品/支付等
│   └── 对比维度：同比/环比/增长率
│
├── 实现方案（按优先级）
│   ├── 方案 A：实时查询（小数据量 < 100万）
│   ├── 方案 B：预计算 + 缓存（中数据量，推荐）✅
│   └── 方案 C：分析引擎（大数据量，可选）
│
├── 可复用
│   ├── StatisticsController → 统计 API 模板（参考实现）
│   ├── FastExcel（已集成）→ Excel 导出功能
│   ├── SnailJob（已集成）→ 定时预计算任务
│   └── ruoyi-common-redis（已集成）→ 统计结果缓存
│
└── 数据库优化
    ├── 统计表设计（星型模型或雪花模型）
    ├── 索引优化（时间、租户、业务字段）
    ├── 分区表设计（按时间分区）
    └── 副本/只读从库（大查询避免业务库）
```

### 场景 6：AI 功能集成

```
需求：增加 AI 辅助功能

头脑风暴：
├── 需要自行集成（框架未内置）
│   ├── LangChain4j → 需自行引入 Maven 依赖
│   ├── SSE（已集成）→ 流式响应支持
│   └── Redis 缓存 → 会话上下文存储
│
├── 应用方向（选 2-3 个）
│   ├── 智能客服（多轮对话、FAQ）
│   ├── 内容生成（文案、总结、翻译）
│   ├── 数据分析（自然语言 SQL 查询）
│   ├── 代码生成（API 文档生成）
│   └── 知识库问答（RAG 系统）
│
├── 模型选择
│   ├── ChatGPT（OpenAI，国际）
│   ├── DeepSeek（国产，便宜）✅ 推荐
│   ├── 通义千问（阿里云）
│   ├── 文心一言（百度）
│   └── Claude API（性能最好）
│
├── 需要自行开发的模块
│   ├── ChatSessionEntity → 会话表
│   ├── ChatMessageEntity → 消息表
│   ├── AiService → AI 调用服务
│   └── AiModelConfig → 模型配置管理
│
└── 实现要点
    ├── 流式响应（使用 SSE，已集成）
    ├── 上下文管理（Redis 存储）
    ├── Token 计费与统计
    ├── 敏感词/内容过滤
    ├── 多模型支持（策略模式）
    └── 错误重试与降级
```

---

## 创意激发技巧（本项目版）

### 1. 模块组合法

```
问题：如何实现活动抽奖功能？

模块组合：
├── ruoyi-common-redis → 库存/次数控制
├── ruoyi-common-ratelimiter → 防刷
├── ruoyi-common-idempotent → 防重复
├── ruoyi-common-websocket → 实时开奖
├── ruoyi-common-job → 定时开奖
└── 现有订单流程 → 奖品发放

组合方案：
1. 活动配置（参考 Ad 模块）
2. 抽奖服务（Redis Lua 脚本原子操作）
3. 中奖记录（标准 CRUD）
4. 奖品发放（复用订单流程）
```

### 2. 现有功能类比法

```
问题：如何实现预约功能？

类比分析：
├── 类似订单 → 创建、状态流转、取消
├── 类似活动 → 时间段、名额限制
└── 类似秒杀 → 库存控制、并发处理

复用点：
├── 订单状态机 → 预约状态流转
├── 库存扣减逻辑 → 名额控制
├── 支付流程 → 预约押金
└── 消息通知 → 预约提醒
```

### 3. 端优先思考法

```
问题：功能应该在哪个端实现？

决策树：
├── 管理操作（配置、审核）→ PC 端
├── 用户操作（下单、查看）→ 移动端
├── 实时展示（监控、大屏）→ PC 端
└── 高频操作（签到、扫码）→ 移动端

多端同步考虑：
├── 数据实时性 → WebSocket
├── 操作幂等性 → Redis 分布式锁
└── 状态一致性 → 事件驱动
```

### 4. 多租户思考法

```
问题：功能是否需要租户隔离？

判断标准：
├── 租户私有数据 → 必须隔离
│   └── 用户、订单、商品、配置
├── 平台公共数据 → 不需要隔离
│   └── 字典、地区、系统配置
└── 混合数据 → 条件隔离
    └── 模板（平台模板 + 租户模板）

实现方式：
├── Entity 继承 TenantEntity
├── 自动 SQL 过滤
└── 租户配置表设计
```

---

## 讨论引导问题（本项目版）

### 功能规划时

1. **复用视角**
   - 有没有类似的现有功能？
   - 能复用哪些 common 模块？
   - 需要新开发多少代码？

2. **多端视角**
   - PC 端需要什么？
   - 移动端需要什么？
   - 两端数据如何同步？

3. **多租户视角**
   - 数据需要租户隔离吗？
   - 配置是租户级还是系统级？
   - 不同租户能定制吗？

4. **技术视角**
   - 现有技术栈能实现吗？
   - 需要引入新技术吗？
   - 有没有性能瓶颈？

### 方案选择时

1. **短期 vs 长期**
   - 快速上线重要还是可扩展重要？
   - 以后可能怎么扩展？

2. **简单 vs 完整**
   - MVP 版本包含什么？
   - 完整版本还需要什么？

3. **风险评估**
   - 最大的技术风险是什么？
   - 最大的业务风险是什么？
   - 如何降低风险？

---

## 与其他 Skill 联动

> **注意**：本项目是纯后端项目。前端开发（PC 端）在分离的项目中进行：
> - **PC 端前端**：`plus-ui` 项目（Vue 3 + Element Plus）

### 后端开发的 Skill 联动路径

```
brainstorm（本 Skill）
    ↓ 确定方案后
    │
    ├── 需要建表 → database-ops
    │   └── 设计数据库结构、建立多库支持
    │
    ├── 需要后端开发 → crud-development
    │   ├── 生成 CRUD 代码
    │   ├── 实现 Service 与 DAO
    │   └── 需要高级注解 → security-guard/data-permission/error-handler
    │
    ├── 需要定时任务 → 使用 SnailJob（已集成）或 @Scheduled
    │   └── 参考：SnailJob 管理后台配置
    │
    ├── 需要 WebSocket/SSE → 使用已集成的 ruoyi-common-websocket
    │   └── 参考：WebSocket 消息推送示例
    │
    ├── 需要支付接入 → 自行开发（框架未内置支付模块）
    │   └── 推荐使用 IJPay 等开源 SDK，参考场景 4 的方案
    │
    ├── 需要微信功能 → social-login（第三方登录部分）
    │   └── JustAuth 已集成微信登录；小程序/公众号功能需自行开发
    │
    ├── 需要 AI 功能 → 需自行集成 LangChain4j（框架未内置）
    │   └── 参考场景 6：引入 Maven 依赖，配合 SSE 实现流式响应
    │
    └── 需要技术方案对比 → tech-decision
        └── 缓存、消息队列、实时通信等技术选型
```

### 快速触发其他后端 Skill

| 头脑风暴结论 | 下一步 Skill | 触发方式 |
|-------------|-------------|---------|
| 需要新建业务模块 | crud-development | "帮我开发 xxx 模块" |
| 需要数据库设计 | database-ops | "帮我设计 xxx 表" |
| 需要安全认证 | security-guard | "怎么控制权限访问" |
| 需要数据权限 | data-permission | "怎么按部门/租户隔离数据" |
| 需要异常处理 | error-handler | "怎么规范异常处理" |
| 需要接入支付 | 自行开发（参考场景 4） | "帮我接入 xxx 支付" |
| 需要技术对比 | tech-decision | "Redis 还是本地缓存好" |
| 需要代码规范 | code-patterns | "怎么写代码规范" |

### 前端开发联系

当完成后端 API 开发后，前端团队可以：
- **PC 端开发**：参考对应 `plus-ui` 项目的 Skill 指南

前端调用后端 API，确保数据一致性。

---

## 头脑风暴输出模板

### 完整输出格式

```markdown
# [功能名称] 方案设计

## 1. 问题定义
- 需求描述：[xxx]
- 业务价值：[xxx]
- 模块归属：[base/mall/crm/iot]
- 端支持：[PC/移动端/两者]

## 2. 可复用资源
| 资源 | 类型 | 复用程度 |
|------|------|---------|
| ruoyi-common-xxx | 模块 | 完全复用 |
| Xxx 功能 | 代码 | 参考模式 |

## 3. 方案对比
| 维度 | 方案 A | 方案 B |
|------|-------|-------|
| 复用度 | 高 | 中 |
| 开发量 | 小 | 中 |
| 扩展性 | 中 | 高 |

## 4. 推荐方案
**方案 A** - [理由]

## 5. 实施步骤
1. [ ] xxx
2. [ ] xxx
3. [ ] xxx

## 6. 风险与应对
| 风险 | 应对策略 |
|------|---------|
| xxx | xxx |
```

---

## 常见问题快速决策

| 问题 | 推荐方案 | 原因 |
|------|---------|------|
| 新功能放哪个模块？ | 看业务相关性 | base=基础、mall=商城、crm=客户、iot=设备、sys=系统 |
| 需要新建 common 模块吗？ | 通常不需要 | 20+ 个模块覆盖大部分场景 |
| 用 WebSocket 还是 SSE？ | WebSocket | 双向通信、已有封装、推荐优先 |
| 用 RocketMQ 还是 Redis？ | Redis 优先 | Redis Streams 简单场景够用，复杂再用 MQ |
| 要不要支持多数据库？ | 是 | 项目标准要求、SQL 脚本需同步 4 个库 |
| 要不要支持多租户？ | 业务数据要 | 继承 TenantEntity 自动隔离 |
| PC 和移动端用同一个 API？ | 是 | 统一后端，按需扩展（分离项目维护） |
| 定时任务用什么？ | 看复杂度 | 简单→@Scheduled，复杂/分布式→SnailJob |
| 文件上传用什么存储？ | AWS S3 SDK | 已集成、支持 MinIO 自建 |
| 需要权限控制吗？ | 是 | Sa-Token 框架标准、@SaCheckPermission |
| 怎么处理敏感数据？ | 字段级加密 | ruoyi-common-encrypt、@EncryptField |
| 需要操作日志吗？ | 是 | @Log 注解、ruoyi-common-log |
| 接口频率限制怎么做？ | @RateLimiter | ruoyi-common-ratelimiter |
| 防重复提交怎么处理？ | @RepeatSubmit | ruoyi-common-idempotent、Redis 分布式锁 |
| 短信通知怎么发？ | SMS4j | 已集成、支持多平台（阿里云/腾讯/华为） |
| 邮件通知怎么发？ | Spring Mail | 已集成、支持 SMTP |
| 第三方登录用什么？ | JustAuth | 已集成、支持 30+ 平台 |
| 数据导出用什么？ | FastExcel | 已集成、性能优于 EasyExcel |
| 需要 AI 功能吗？ | LangChain4j | 需自行引入依赖、支持多模型 |
| 国际化翻译怎么做？ | ruoyi-common-translation | 已集成、i18n 消息 |
| 分布式锁怎么选？ | Redisson | 基于 Redis、已集成 |
| 缓存布隆过滤器？ | Redisson BloomFilter | 防缓存穿透 |
