# 路由配置指南

> **适用于**: 腾云智慧食堂管理系统前端项目（`/Users/xujiajun/Developer/frontProj/web`）

最后更新: 2026-02-18

---

## 路由文件结构

```
src/router/
├── index.js            # 路由入口：创建路由实例、全局前置守卫
├── static-routers.js   # 静态路由：不需要权限的页面（登录、404、大屏等）
├── business-routers.js # 业务路由：商户管理相关页面
└── campus-routers.js   # 园区路由：园区相关页面
```

`src/permission.js` — 全局路由守卫（登录、权限、动态路由加载）

---

## 静态路由 (static-routers.js)

不需要登录权限的页面配置在这里，每条路由都设置 `hidden: true`（不在侧边栏显示）：

```javascript
// src/router/static-routers.js
import Layout from '@/layout'

export default [
  {
    path: '/login',
    name: 'login',
    // ⭐ 懒加载规范：使用 webpackChunkName 注释
    component: () => import(/* webpackChunkName: "login" */ '@/leniuview/login/index'),
    hidden: true
  },
  {
    path: '/404',
    name: '404',
    component: () => import(/* webpackChunkName: "404" */ '@/leniuview/error/404'),
    hidden: true
  },
  // 有 Layout 框架、但不在菜单显示的页面
  {
    path: '',
    component: Layout,
    hidden: true,
    meta: {
      title: '首页',
      icon: 'home'
    }
  }
]
```

---

## 业务路由 (business-routers.js)

有 Layout 框架、需要权限的业务页面，组织为父子路由结构：

```javascript
// src/router/business-routers.js
import Layout from '@/layout'
import LayoutView from '@/layout/layout'  // 嵌套路由时使用

export default {
  path: '/initialized',
  component: Layout,      // 使用主布局
  redirect: 'noRedirect',
  name: '商户',
  meta: {
    title: '商户',
    icon: 'component'
  },
  children: [
    {
      path: 'initial',
      // ⭐ 懒加载：webpackChunkName 与 name 保持一致
      component: () => import(/* webpackChunkName: "initial" */ '@/leniuview/Business/initialized'),
      name: '商户注册',
      meta: {
        title: '商户注册',
        redirect: 'audit'
      }
    },
    {
      path: 'initializedList',
      component: () => import(/* webpackChunkName: "initializedList" */ '@/leniuview/Business/initializedList'),
      name: '商户审核',
      meta: {
        title: '商户审核',
        noCache: true       // 不缓存该页面
      }
    }
  ]
}
```

---

## 懒加载规范

```javascript
// ✅ 正确：使用 webpackChunkName 注释
component: () => import(/* webpackChunkName: "moduleName" */ '@/leniuview/xxx/index')

// ✅ webpackChunkName 命名建议与路由 name 保持一致
{
  path: 'priceRule',
  name: 'priceRule',
  component: () => import(/* webpackChunkName: "priceRule" */ '@/leniuview/marketing/priceRule/index')
}

// ❌ 不推荐：不加 webpackChunkName（影响分包优化）
component: () => import('@/leniuview/xxx/index')
```

---

## meta 字段说明

| 字段 | 类型 | 说明 | 示例 |
|------|------|------|------|
| `title` | String | 页面标题（显示在浏览器标签和面包屑） | `'营销规则管理'` |
| `icon` | String | 菜单图标名称 | `'component'` |
| `noCache` | Boolean | 是否禁用页面缓存（`<keep-alive>`）默认缓存 | `true` |
| `hidden` | Boolean | 是否在侧边菜单中隐藏 | `true` |
| `redirect` | String | 重定向目标 | `'audit'` |
| `affix` | Boolean | 是否固定在 tab 栏（不可关闭） | `true` |

---

## 权限路由控制流程

`permission.js` 中的全局前置守卫流程：

```
用户访问页面
    ↓
有 Token?
    ├── 否 → 是白名单页面? → 是 → 直接访问
    │                      → 否 → 跳转 /login
    └── 是 → 已加载用户角色?
              ├── 是 → 直接 next()
              └── 否 → 调用 store.dispatch('user/getInfo')
                            ↓
                        根据角色加载动态路由
                        store.dispatch('permission/generateRoutes', roles)
                            ↓
                        router.addRoutes(accessedRoutes)
                            ↓
                        next({ ...to, replace: true })
```

### 白名单页面（无需登录）

```javascript
// src/permission.js
const whiteList = [
  '/login',
  '/ssoLogin',
  '/openLogin',
  '/404',
  '/registeredCompany',
  '/registeredCompanyLinS',
  '/resetPassword',
  '/registerSupplier',
  '/cooperativePartner',
  '/dataHunter_user',
  '/dataHunter_back',
  '/dataHunter_merchant',
  '/backCustomScreen'
]
```

---

## 新增路由步骤

### 1. 不需要权限的页面（静态路由）

在 `static-routers.js` 中添加：

```javascript
{
  path: '/myPage',
  name: 'myPage',
  component: () => import(/* webpackChunkName: "myPage" */ '@/leniuview/myModule/index'),
  hidden: true
}
```

### 2. 需要权限的业务页面（业务路由）

在对应的业务路由文件（如 `business-routers.js`）的 `children` 中添加：

```javascript
{
  path: 'myFeature',
  component: () => import(/* webpackChunkName: "myFeature" */ '@/leniuview/Business/myFeature/index'),
  name: '我的功能',
  meta: {
    title: '我的功能',
    noCache: true
  }
}
```

### 3. 动态权限路由

从后端接口获取用户有权限的菜单，由 Vuex `permission` 模块动态生成路由，无需手动添加。

---

## 路由实例管理

```javascript
// src/router/index.js
import { resetRouter } from '@/router'

// 登出时重置路由（清除动态添加的权限路由）
resetRouter()
```

---

## 常见问题

### 重复点击相同路由报错

已在 `router/index.js` 中全局处理，忽略 `NavigationDuplicated` 错误，无需每个页面单独处理。

### 页面不缓存

在路由 meta 中添加 `noCache: true`，同时确保组件有 `name` 属性（`keep-alive` 按组件 name 缓存）。

### 检查当前用户是否有某页面权限

```javascript
import { checkMenu } from '@/utils/auth'

const hasAccess = checkMenu('/marketing/price')
```
