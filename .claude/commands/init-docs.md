# /init-docs - 初始化业务文档

作为项目文档初始化助手，根据用户选择的模式初始化项目文档。

---

## 🎯 第一步：检测项目类型

### 检查根目录是否存在 `plus-ui/` 目录

```bash
Glob pattern: "plus-ui/"
```

**如果存在 plus-ui/**：
> 检测到前端项目 `plus-ui/`，当前初始化仅生成后端文档。
> 前端页面相关文档请在前端项目中管理。

**如果不存在 plus-ui/**：
> 当前为纯后端项目。如需开发前端页面，请创建 plus-ui 项目。

---

## 🎯 第二步：询问用户选择模式

**向用户展示以下选项：**

```
请选择文档初始化模式：

1️⃣ **空白模板模式**（推荐新项目）
   - 创建空白的项目管理文档
   - 由你手动填写业务需求和设计方案
   - 适合：开始新业务功能开发、记录产品需求

2️⃣ **扫描现有代码模式**
   - 自动扫描代码库，生成当前实现状态报告
   - 统计已完成的模块、待办事项、技术债务
   - 适合：了解项目现状、梳理进度

请输入 1 或 2 选择模式：
```

---

## 📝 模式一：空白模板模式

### 执行条件
用户选择 `1` 或 输入 `空白`、`模板`、`新项目` 等关键词

### 执行步骤

#### 1. 询问项目信息

向用户询问：
- **项目名称**：业务功能的中文名称
- **项目简述**：一句话描述项目目标（可选）

#### 2. 创建空白文档

基于以下模板创建三个文件到 `docs/` 目录：

##### 项目状态.md（空白模板）

```markdown
# [项目名称] - 项目状态

> 最后更新：[当前日期]

## 项目概述

**项目名称**：[项目名称]
**项目简述**：[项目简述]
**开始时间**：[当前日期]
**预计完成**：待定
**当前阶段**：需求分析

## 进度总览

| 阶段 | 状态 | 说明 |
|------|------|------|
| 需求分析 | 🟡 进行中 | |
| 技术设计 | ⚪ 未开始 | |
| 后端开发 | ⚪ 未开始 | |
| 测试验收 | ⚪ 未开始 | |

## 里程碑

- [ ] 需求文档完成
- [ ] 技术方案评审
- [ ] 后端接口开发完成
- [ ] 功能测试通过
- [ ] 上线发布

## 风险与问题

暂无

## 变更记录

| 日期 | 变更内容 | 负责人 |
|------|---------|--------|
| [当前日期] | 项目启动 | |
```

##### 需求文档.md（空白模板）

```markdown
# [项目名称] - 需求文档

> 版本：v1.0 | 更新时间：[当前日期]

## 1. 背景与目标

### 1.1 业务背景

[描述为什么需要这个功能，解决什么业务问题]

### 1.2 项目目标

- 目标1：
- 目标2：
- 目标3：

## 2. 用户故事

### 2.1 用户角色

| 角色 | 说明 |
|------|------|
| 管理员 | |
| 普通用户 | |

### 2.2 用户故事列表

| 编号 | 作为... | 我想要... | 以便于... | 优先级 |
|------|--------|----------|----------|--------|
| US-001 | | | | P0 |
| US-002 | | | | P1 |

## 3. 功能需求

### 3.1 功能列表

| 功能模块 | 功能点 | 说明 | 优先级 |
|---------|-------|------|--------|
| | | | |

### 3.2 功能详情

#### 3.2.1 [功能名称]

**功能描述**：

**业务规则**：
1.
2.

**接口需求**：

## 4. 非功能需求

### 4.1 性能要求

- 响应时间：
- 并发量：

### 4.2 安全要求

- 权限控制：
- 数据安全：

## 5. 数据设计

### 5.1 数据模型

| 字段名 | 类型 | 说明 | 必填 |
|-------|------|------|------|
| | | | |

### 5.2 数据字典

| 字典类型 | 字典名称 | 字典项 |
|---------|---------|--------|
| | | |

## 6. 接口设计

### 6.1 接口列表

| 接口名称 | 方法 | 路径 | 说明 |
|---------|------|------|------|
| | | | |

## 7. 附录

### 7.1 术语表

| 术语 | 说明 |
|------|------|
| | |

### 7.2 参考资料

-
```

##### 待办清单.md（空白模板）

```markdown
# [项目名称] - 待办清单

> 最后更新：[当前日期]

## 当前迭代

### 🔴 紧急/重要

- [ ]

### 🟡 进行中

- [ ]

### 🟢 待开始

- [ ]

## 任务分解

### 1. 需求分析阶段

- [ ] 整理业务需求
- [ ] 编写需求文档
- [ ] 需求评审

### 2. 技术设计阶段

- [ ] 数据库表设计
- [ ] 接口设计
- [ ] 技术方案评审

### 3. 后端开发阶段

- [ ] 创建数据库表
- [ ] 创建实体类和 Mapper
- [ ] 实现 Service 业务逻辑
- [ ] 实现 Controller 接口
- [ ] 接口测试

### 4. 测试上线阶段

- [ ] 功能测试
- [ ] Bug 修复
- [ ] 上线部署

## 已完成

### [日期]

- [x] 示例：完成的任务

## 问题记录

| 日期 | 问题 | 状态 | 解决方案 |
|------|------|------|---------|
| | | | |
```

#### 3. 输出结果

```
✅ 项目管理文档已创建（空白模板模式）

📁 docs/
├── 项目状态.md      # 进度追踪
├── 需求文档.md      # 业务需求
└── 待办清单.md      # 任务清单

💡 下一步：
1. 编辑 docs/需求文档.md 填写业务需求
2. 在 docs/待办清单.md 中分解任务
3. 使用 /progress 查看项目进度
4. 使用 /add-todo 快速添加待办
```

---

## 📊 模式二：扫描现有代码模式

### 执行条件
用户选择 `2` 或 输入 `扫描`、`现有`、`分析` 等关键词

### 执行步骤

以下是扫描模式的详细步骤...

---

## ⚠️ 重要：只扫描业务模块，不扫描框架

**框架部分（不扫描、不统计）**:
- ❌ `ruoyi-common/*` - 通用工具模块（20+ 子模块）
- ❌ `ruoyi-admin` - 启动入口
- ❌ `ruoyi-modules/ruoyi-system` - 系统管理模块
- ❌ `ruoyi-modules/ruoyi-generator` - 代码生成器
- ❌ `ruoyi-modules/ruoyi-demo` - 官方示例模块
- ❌ `ruoyi-modules/ruoyi-job` - 定时任务模块
- ❌ `ruoyi-modules/ruoyi-workflow` - 工作流引擎模块

**业务部分（重点扫描）**:
- ✅ `ruoyi-modules/ruoyi-*`（排除上述 6 个框架模块：system、generator、demo、job、workflow、common）
  - 示例：`ruoyi-business/`、`ruoyi-mall/`、`ruoyi-iot/`、`ruoyi-crm/` 等

## 你需要做的：

### 1. 读取模板文件
- `.claude/templates/项目状态模板.md`
- `.claude/templates/需求文档模板.md`
- `.claude/templates/待办清单模板.md`

### 2. 智能识别业务模块结构

#### 第一步：识别业务 Maven 模块
**扫描路径**: `ruoyi-modules/`

**识别规则**:
1. 列出 `ruoyi-modules/` 下的所有 `ruoyi-*` 目录
2. **排除 6 个框架模块**：
   - ❌ `ruoyi-system` - 系统管理模块
   - ❌ `ruoyi-generator` - 代码生成器
   - ❌ `ruoyi-demo` - 官方示例模块
   - ❌ `ruoyi-job` - 定时任务模块
   - ❌ `ruoyi-workflow` - 工作流引擎模块
   - ❌ `ruoyi-common` - 通用工具模块
3. **业务模块示例**：
   - ✅ `ruoyi-business` - 基础业务模块
   - ✅ `ruoyi-iot` - IoT 设备管理模块
   - ✅ `ruoyi-mall` - 商城模块
   - ✅ 其他自定义业务模块

**判断标准**：
```
业务模块特征：
1. 位于 ruoyi-modules/ruoyi-* 目录
2. 不在框架模块排除列表中
3. 包含 src/main/java/org/dromara/{模块名}/ 目录
4. 有 controller、service、mapper、domain 等包结构
```

**特别注意**：
- 如果检测到 0 个业务模块 → 这是全新项目，生成空的业务文档模板
- 提示用户："当前是全新框架，尚无业务代码。开发业务功能后再次执行本命令更新文档。"

#### 第二步：分析每个业务模块的内部结构

对每个识别出的业务模块（如 `ruoyi-business`、`ruoyi-iot`）：

##### 方式A：单层结构（直接包含 controller）
```
ruoyi-iot/
└── src/main/java/org/dromara/iot/
    ├── controller/
    │   ├── DeviceController.java
    │   ├── ProductController.java
    │   └── OtaController.java
    ├── service/
    ├── mapper/
    └── domain/
```
**识别方式**：直接统计 controller 数量，每个 Controller = 一个功能模块

##### 方式B：多层结构（按业务领域分包）
```
ruoyi-business/
└── src/main/java/org/dromara/business/
    ├── ai/
    │   ├── controller/
    │   ├── service/
    │   ├── mapper/
    │   └── domain/
    ├── base/
    │   ├── controller/
    │   └── ...
    └── platform/
        ├── controller/
        └── ...
```
**识别方式**：
1. 识别子包目录（ai、base、platform 等）
2. 每个子包代表一个业务领域
3. 统计每个子包下的 Controller 数量

**自动判断使用哪种方式**：
- 如果 `src/main/java/org/dromara/{模块名}/` 下直接有 `controller/` 目录 → 使用方式A
- 如果下面还有子目录（如 ai/、base/），且子目录下有 `controller/` → 使用方式B

#### 第三步：统计功能模块完整性

对每个 Controller，检查对应的 **7 个必需文件**：

| 文件类型 | 文件位置 | 必须 |
|---------|---------|------|
| Entity | `domain/Xxx.java` | ✅ |
| BO | `domain/bo/XxxBo.java` | ✅ |
| VO | `domain/vo/XxxVo.java` | ✅ |
| Mapper | `mapper/XxxMapper.java` | ✅ |
| Service 接口 | `service/IXxxService.java` | ✅ |
| Service 实现 | `service/impl/XxxServiceImpl.java` | ✅ |
| Controller | `controller/XxxController.java` | ✅ |

**完整度计算**：`存在文件数 / 7 × 100%`

### 3. 深度分析代码 TODO

**扫描范围** (只扫描业务代码):
```bash
# 后端业务模块
ruoyi-modules/ruoyi-*/src/main/java/**/*.java
# 排除 6 个框架模块：system、generator、demo、job、workflow、common
```

**提取规则**:
1. 提取 `// TODO:`、`// FIXME:`、`// HACK:` 注释
2. 记录完整的文件相对路径和精确行号
3. 提取 TODO 的完整描述文本
4. 智能分类：
   - **高优先级**: 包含 `FIXME`、`URGENT`、`CRITICAL` 关键词
   - **中优先级**: 普通 `TODO`
   - **低优先级**: 包含 `OPTIMIZE`、`ENHANCE`、`NICE_TO_HAVE` 关键词
5. 识别模块归属（根据文件路径判断属于哪个业务模块）

**输出格式**:
```markdown
- [ ] 实现RAG检索逻辑
  - 截止日期: 待定
  - 描述: 在ChatService中实现RAG检索和流式RAG检索
  - 位置: ruoyi-modules/ruoyi-business/src/main/java/org/dromara/business/ai/service/impl/ChatServiceImpl.java:182
  - 模块: ruoyi-business (AI 功能领域)
  - 预计工作量: 3-5天
```

### 4. 智能分析 Git 提交

**分析最近 20-30 条提交**:
1. 提取提交信息、日期、修改的文件
2. **区分框架提交 vs 业务提交**：
   - 框架提交：修改 `ruoyi-common/`、`ruoyi-admin/` 或系统管理相关代码
   - 业务提交：修改业务模块代码
3. **提取业务功能的提交信息**：
   - 识别关键词：`feat`、`fix`、`update`、`add`、`implement`
   - 提取功能描述
4. **计算开发耗时**：
   - 根据同一模块的首次提交和最后提交计算
5. **识别最近开发的模块**：
   - 按提交频率排序
   - 标注最活跃的业务模块

### 5. 生成高质量文档到 `docs/` 目录

#### 📊 项目状态文档 (`docs/项目状态.md`)

**必须包含的内容**:

##### 1. 项目概况
```markdown
## 📊 当前状态
- 项目阶段: 开发中/测试中/已上线
- **业务进度**: X% (只统计业务模块)
- **框架状态**: ✅ 已完成（系统管理 + 通用工具 + 代码生成 + 定时任务 + 工作流）
- 下一步计划: [从待办事项中提取优先级最高的 3 项]

## 📦 框架模块（已完成，不统计进度）
- ✅ 系统管理：用户、角色、菜单、字典、参数配置等
- ✅ 代码生成器：支持单表、树表、主子表代码生成
- ✅ 通用工具库：20+ 子模块（MyBatis、Redis、Sa-Token、OSS 等）
- ✅ 定时任务：SnailJob 分布式任务调度
- ✅ 工作流引擎：WarmFlow 审批流程

详见：CLAUDE.md
```

**如果检测到 0 个业务模块（全新项目）**：
```markdown
## 📊 当前状态
- 项目阶段: 初始化
- **业务进度**: 0% (尚未开发业务功能)
- **框架状态**: ✅ 已完成
- 下一步计划: 开始第一个业务功能开发

## 🎯 这是一个全新项目
当前只有框架代码，尚未开发任何业务功能。

**框架已包含**：
- ✅ 系统管理功能
- ✅ 代码生成器
- ✅ 通用工具库（20+ 模块）
- ✅ 定时任务（SnailJob）
- ✅ 工作流引擎（WarmFlow）

**下一步**：
使用 `/dev` 或代码生成器开始开发第一个业务功能。
```

##### 2. 业务模块统计（按 Maven 模块分组）
```markdown
## ✅ 已完成

### ruoyi-xxx 模块 - 已完成 X 个 / 共 Y 个
- [x] 功能名称 (完成日期: YYYY-MM-DD)
  - 耗时: X天 (根据Git提交计算)
  - 说明: 功能描述
  - 完整度: 100% (Entity✅ BO✅ VO✅ Controller✅ Service✅ Mapper✅)
```

##### 3. 进行中模块（完整度 < 100%）
```markdown
## 🚧 进行中

### ruoyi-xxx 模块

- [ ] 功能名称 (开始: YYYY-MM-DD)
  - 进度: X%
  - 预计完成: YYYY-MM-DD
  - 缺失部分:
    - ⏳ XxxVo.java (视图对象未创建)
    - ⏳ XxxBo.java (业务对象未创建)
  - 位置: ruoyi-modules/ruoyi-xxx/src/main/java/org/dromara/xxx/
```

##### 4. 待办任务
```markdown
## 📋 待办

### 高优先级
- [ ] 任务描述
  - 优先级: 高
  - 预计工作量: X天
  - 位置: 文件路径:行号
  - 模块: ruoyi-xxx
```

##### 5. 技术债务和问题
```markdown
## ⚠️ 问题和风险

### 技术债务
- **TODO 标记**: 项目中存在 X 个 TODO 标记
  - 按模块分类列出...
```

#### 📋 需求文档 (`docs/需求文档.md`)

**必须包含的内容**:

##### 1. 项目概述
```markdown
## 📋 项目概述
- **项目名称**: [从 pom.xml 提取 artifactId]
- **项目类型**: 纯后端企业级管理系统
- **技术栈**: Spring Boot 3 + MyBatis-Plus + Sa-Token
- **包名规范**: org.dromara.*
- **业务模块**: [列出所有业务 Maven 模块]
```

##### 2. 功能需求（按 Maven 模块分类）
```markdown
## 1. 功能需求

### 1.1 ruoyi-xxx 模块

#### REQ-XXX-001: 功能名称
- 优先级: 高
- 预计时间: X天
- 状态: ✅ 已完成 / 🚧 进行中 / ⚪ 待开发
- 描述: 功能描述
- 技术实现:
  - Maven 模块: ruoyi-xxx
  - Entity: Xxx.java
  - Controller: XxxController.java
  - Service: IXxxService.java, XxxServiceImpl.java
  - Mapper: XxxMapper.java
```

##### 3. 技术需求
```markdown
## 2. 技术需求

### 2.1 后端技术栈
[从根 pom.xml 自动提取关键依赖版本]
- **Java**: [java.version]
- **Spring Boot**: [spring-boot.version]
- **MyBatis-Plus**: [mybatis-plus.version]
- **Sa-Token**: [sa-token.version]
- **数据库**: MySQL 8.0+
- **缓存**: Redis + Redisson
```

#### ✅ 待办清单 (`docs/待办清单.md`)

**必须包含的内容**:

##### 1. 按优先级和模块分类
```markdown
## 🔥 高优先级（紧急重要）

### ruoyi-xxx 模块
- [ ] 任务描述
  - 截止日期: YYYY-MM-DD
  - 描述: 详细描述
  - 位置: 文件路径:行号
  - 预计工作量: X天
```

##### 2. 统计信息
```markdown
## 📊 统计信息

### 按优先级分类
- 🔥 高优先级: X 项
- 📌 中优先级: Y 项
- 💡 低优先级: Z 项

### 按 Maven 模块分类
- ruoyi-xxx 模块: X 项

### 工作量统计
- 预计总工作量: 约 X 天
- 高优先级工作量: Y 天
```

---

## 📏 质量标准

### ✅ 优秀文档的特征
1. **完整度明确**: 用百分比表示，不模糊
2. **代码定位精确**: 完整的相对路径 + 行号
3. **工作量合理**: 根据 Git 提交历史估算
4. **分类清晰**: 按 Maven 模块分类
5. **信息完整**: 包含依赖、影响范围、解决方案
6. **统计准确**: 数量、百分比、工作量都有数据支撑

### ❌ 必须避免的问题
1. **不要统计框架代码**: 只关注业务模块（排除 6 个框架模块：system、generator、demo、job、workflow、common）
2. **不要只统计文件数**: 要分析功能完整度（7 个必需文件）
3. **不要笼统描述**: "XX 模块已完成" → "XX 模块 100% (Entity✅ BO✅ VO✅...)"
4. **不要遗漏 TODO**: 深度扫描所有业务模块代码中的 TODO 标记
5. **不要估算过于乐观**: 工作量评估要参考历史提交
6. **不要忽略技术债务**: 单独列出 FIXME 和已知问题
7. **包名必须正确**: `org.dromara.*`（非 `plus.ruoyi`、非 `com.ruoyi`）
8. **三层架构**: Controller → Service → Mapper（无 DAO 层）

## 注意事项

### 文档生成后
- 所有文档保存到 `docs/` 目录
- 填充真实数据，不留空模板
- 生成后提供文档摘要和主要发现
- 建议用户根据实际情况调整

### 时间和数据格式
- 时间格式: `YYYY-MM-DD HH:MM`
- 进度百分比: 0-100%，保留整数
- 工作量: X天/周，整数估算
- 完成日期: 从 Git 提交记录提取

### 智能推断
- 如果 Git 记录无法确定完成日期，标注"待确认"
- 如果工作量无法估算，根据代码复杂度给出范围（如 3-5天）
- 如果模块分类不明确，按实际目录结构组织

---

## 🔗 相关命令

| 命令 | 说明 | 用途 |
|------|------|------|
| `/start` | 快速了解项目 | 初次接触项目 |
| `/progress` | 查看项目进度 | 了解完成情况 |
| `/sync` | 全量同步报告 | 定期整理文档 |
| `/add-todo` | 添加待办任务 | 跟踪任务 |
| `/next` | 获取下一步建议 | 确定开发方向 |
